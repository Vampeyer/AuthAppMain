<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Success</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>body{background:linear-gradient(135deg,#1a3c34,#4b0082,#000);color:#fff;padding-top:80px}</style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/streampaltest/public/index.html">Movies App</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="/streampaltest/public/index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/streampaltest/public/signup.html">Sign Up</a></li>
        <li class="nav-item"><a class="nav-link" href="/streampaltest/public/login.html">Login</a></li>
        <li class="nav-item"><a class="nav-link" href="/streampaltest/public/subscription/movie_content.html">Movie Content</a></li>
        <li class="nav-item"><a class="nav-link" href="/streampaltest/public/profile.html">Profile</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-5 text-center">
  <h1 class="display-4">Payment Successful!</h1>
  <p class="lead">Activating subscription…</p>
  <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading…</span></div>
</div>

<script src="protected/js/auth.js"></script>
<script>
  const urlParams = new URLSearchParams(location.search);
  const sessionId = urlParams.get('session_id');
  if (!sessionId) { alert('No session ID'); location.href='/streampaltest/public/profile.html'; }

  (async () => {
    try {
      const r = await loggedFetch(`${API_URL}/verify-session`, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({sessionId})
      });
      const d = await r.json();
      if (d.active) setTimeout(()=>location.href='/streampaltest/public/profile.html',1500);
      else alert('Activation failed');
    } catch (e) { alert('Error'); }
  })();
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>