<script type="module">
  import { authFetch, clearToken } from './protected/js/auth.js?v=20251115';

  async function loadProfile() {
    try {
      const res = await authFetch('/profile');
      if (res.status === 401) { clearToken(); window.location.href = 'login.html'; return; }
      const data = await res.json();

      document.getElementById('loading').style.display = 'none';
      document.getElementById('profileData').style.display = 'block';

      document.getElementById('username').textContent = data.username;
      document.getElementById('email').textContent = data.email;

      const statusEl = document.getElementById('subscriptionStatus');
      statusEl.textContent = data.subscription_active ? 'Active' : 'Inactive';
      statusEl.classList.toggle('green', data.subscription_active);
      statusEl.classList.toggle('red', !data.subscription_active);
    } catch (err) {
      document.getElementById('error').style.display = 'block';
    }
  }

  window.addEventListener('load', loadProfile);
</script>